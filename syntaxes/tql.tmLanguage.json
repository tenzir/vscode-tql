{
  "$schema": "https://raw.githubusercontent.com/martinring/tmlanguage/master/tmlanguage.json",
  "name": "TQL",
  "patterns": [
    {
      "include": "#x_root"
    }
  ],
  "fileTypes": [
    "tql"
  ],
  "foldingStartMarker": "\\{\\s*$",
  "foldingStopMarker": "^\\s*\\}",
  "repository": {
    "x_root": {
      "patterns": [
        {
          "comment": "TODO: Refactor me",
          "begin": "(if)",
          "beginCaptures": {
            "0": {
              "name": "keyword"
            }
          },
          "patterns": [
            {
              "include": "#x_common"
            }
          ],
          "end": "(?=})|(?<!,\\s*)(?<!\\\\\\s*)(?=$)"
        },
        {
          "include": "#x_high"
        },
        {
          "name": "tql.operator_mode",
          "begin": "[a-zA-Z]\\w*(?=\\s)(?!\\s*=)",
          "beginCaptures": {
            "0": {
              "name": "entity.name.function"
            }
          },
          "patterns": [
            {
              "include": "#x_common"
            }
          ],
          "end": "(?=})|(?<!,\\s*)(?<!\\\\\\s*)(?=$)"
        },
        {
          "name": "tql.expression_mode",
          "begin": "(=|\\.)",
          "beginCaptures": {
            "0": {
              "name": "keyword"
            }
          },
          "patterns": [
            {
              "include": "#x_common"
            }
          ],
          "end": "(?<!,\\s*)\n$"
        },
        {
          "include": "#x_common"
        }
      ]
    },
    "x_high": {
      "comment": "HIGH PRIO",
      "patterns": [
        {
          "name": "keyword",
          "match": "(?<=\\b)(_|is|as|use|type|return|def|function|pipeline|let|and|or|in|not|let|this|meta|super|for|if|while|match|else)(?=\\b)"
        }
      ]
    },
    "x_common": {
      "patterns": [
        {
          "include": "#x_high"
        },
        {
          "name": "comment.line",
          "match": "//.*"
        },
        {
          "name": "comment.block",
          "begin": "/\\*",
          "end": "\\*/"
        },
        {
          "name": "tql.paren_expr",
          "patterns": [
            {
              "include": "#x_common"
            }
          ],
          "begin": "\\(",
          "end": "\\)"
        },
        {
          "name": "tql.brackets_expr",
          "patterns": [
            {
              "include": "#x_common"
            }
          ],
          "begin": "\\[",
          "end": "\\]"
        },
        {
          "name": "tql.braces_expr",
          "begin": "{",
          "end": "}",
          "patterns": [
            {
              "name": "tql.record_detected",
              "begin": "\\w+(?=:)",
              "patterns": [
                {
                  "include": "#x_high"
                },
                {
                  "name": "variable.other",
                  "match": "\\w+(?=:)"
                },
                {
                  "include": "#x_common"
                }
              ],
              "comment": "(?<!,\\s*)(?=$) <<-- REMOVE THIS",
              "end": "(?=})"
            },
            {
              "comment": "TODO: THIS IS COPIED FROM ABOVE",
              "name": "tql.braces_expr_is_pipeline",
              "begin": "(?!\\s|$)",
              "patterns": [
                {
                  "include": "#x_root"
                }
              ],
              "end": "(?=})"
            }
          ]
        },
        {
          "name": "constant.tql.ipv4",
          "match": "[0-9]+\\.[0-9]+(\\.[0-9]+)*"
        },
        {
          "name": "constant.tql.ipv6",
          "match": "([0-9a-fA-F]*:){2,}[0-9a-fA-F]*(\\.[0-9]+|:[0-9a-fA-F]*)*"
        },
        {
          "name": "constant.tql.number",
          "match": "[+-]?[0-9][0-9_]*(\\.[0-9][0-9_]*)?([a-zA-Z_][a-zA-Z_0-9]*)?"
        },
        {
          "match": "(\\w+)(\\$)",
          "captures": {
            "0": {
              "name": "keyword"
            },
            "1": {
              "name": "entity.name"
            }
          }
        },
        {
          "name": "entity.name",
          "match": "\\w+(?=:|'|\\$|#)"
        },
        {
          "name": "tql.return_back_to_root",
          "begin": "(\\|)",
          "beginCaptures": {
            "0": {
              "name": "keyword"
            }
          },
          "patterns": [
            {
              "include": "#x_root"
            }
          ],
          "end": "(?=})|(?<!,\\s*)(?<!\\\\\\s*)(?=$)"
        },
        {
          "name": "string.quoted.double.tql",
          "begin": "\"",
          "end": "\"",
          "patterns": [
            {
              "name": "constant.character.escape.tql",
              "match": "\\\\."
            }
          ]
        },
        {
          "name": "keyword",
          "match": "@|;|#|'|\\\\|\\+|-|\\*|/|:|&|=|>|<|\\?|!|\\."
        },
        {
          "name": "entity.name.function",
          "match": "\\w+(?=\\()"
        },
        {
          "name": "constant",
          "match": "(?<=\\b)(true|false|null)(?=\\b)"
        },
        {
          "name": "constant",
          "match": "(?<=')\\w+"
        },
        {
          "name": "constant",
          "match": "\\$\\w+"
        },
        {
          "name": "entity.name",
          "match": "@\\w+"
        },
        {
          "name": "keyword",
          "match": "\\$"
        },
        {
          "name": "variable.other",
          "match": "\\w+"
        }
      ]
    },
    "root": {
      "patterns": [
        {
          "include": "#comments"
        },
        {
          "include": "#string-double"
        },
        {
          "name": "entity",
          "match": "\\b(this|null|_)\\b"
        },
        {
          "name": "keyword.tql",
          "match": "\\buse\\b"
        },
        {
          "match": "(\\|)(\\s*\\w+\\b)?",
          "captures": {
            "0": {
              "name": "entity.name.function"
            },
            "1": {
              "name": "keyword.operator.tql"
            },
            "2": {
              "name": "entity.name.function"
            }
          }
        },
        {
          "name": "keyword.operator.tql",
          "match": "=>|=|:|,|;|::|:|\\."
        },
        {
          "match": "^\\s*\\w+\\b(?!:|,)",
          "name": "entity.name.function.tql"
        },
        {
          "begin": "^ASDFASD\\s*(\\w+)",
          "beginCaptures": {
            "0": {
              "name": "entity.name.function"
            }
          },
          "end": "$",
          "patterns": [
            {
              "match": "\\w+:",
              "name": "entity.name.class"
            }
          ]
        }
      ]
    }
  },
  "scopeName": "text.tql"
}
